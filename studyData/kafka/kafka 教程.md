### kafka入门
1. 消息引擎系统ABC

`Apache kafka`是一款开源的消息引擎系统，这个系统用来做什么用的呢？

- 官方定义：消息引擎系统是一组规范，企业利用这组规范在不同系统之间传递语义准确的消息，实现松耦合的异步式数据传递。
- 民间定义：系统A发送消息到消息引擎系统，系统B从消息引擎系统中拉去系统A发送的消息。

两个重要的事实：
- 消息引擎传输的对象是消息。
- 如何传输消息属于消息引擎设计机制的一部分。

`kafka` 它是使用纯二进制的字节序列，

`kafka`支持消息的传输有两种方式：
- 点对点模型
	> 点对点模型，也是消息队列模型，可以理解为，系统A发送消息只能由系统B接收，其他任何都不能读取到系统A的消息，1v1的

- 发布/订阅模式
	> 它有一个主题(topic)的概念，你可以理解成逻辑语义相近的消息容器。该模型也有发送方和接收方，发送方为发布者(publisher),接收方为订阅者(subscriber)，和点对点模型不同的是，这个模型可能存在多个发布者向相同的主题发送消息，而订阅者也可能有多个，它们都能接收到相同主题的消息。生活中的报纸订阅就是一种典型的发布/订阅模型。


为什么不直接系统A往系统B发送消息呢，中间还隔着一个消息引擎系统？

答案是`削峰填谷`

> `削峰填谷`是指缓冲上下游瞬间突发的流量，使其更平滑，特别是那种发送能力超强的上游系统，如果没有消息引擎系统的保护，`脆弱`的下游系统可能会直接被压垮导致全部服务挂了，但是，有了消息引擎系统，它能够有效的对抗上游的流量冲击，真正做到将上游的`峰`填满到`谷`中，避免了流量的震荡，消息引擎系统的另一个大好处，在于发送方和接收方的松耦合，在这一程度上简化了应用的开发，减少了系统间的不必要的交互。


2. kafka术语
- 消息：(record) kafka是消息引擎，这里的消息就是指kafak处理的主要对象。
- 主题：(topic) 主题是承载消息的逻辑的容器，在实际使用中多用于区分具体的业务。
- 分区：(partition) 一个有序不变的消息序列。每个主题下可以有多个分区。
- 消息位移：(offset) 表示分区中每条消息的位置信息，是一个单调递增且不变的值。
- 副本：(replica) kafka中同一条消息能够被拷贝到多个地方以提供数据冗余，这些地方就是所谓的副本，副本还分为两种，领导者副本(leader) 和追随者副本(follower),各自有不同的角色划分，副本是分区层级下的，即每个分区下可配置多个副本实现高可用。
- 生产者：(producer) 向主题发布新消息的应用程序。
- 消费者：(consumer) 从主题订阅新消息的应用程序。
- 消费者位移：(consumer offset) 表示消费者消费进度，每个消费者都有自己的消费者位移。
- 消费者组：(consumer group) 多个消费者都在一个共同的组里，同时消费多个分区以实现高吞吐。
- 重平衡：(rebalance) 消费者组内某个消费者实例挂掉后，其他的消费者实例自动重新分配订阅主题分区的过程，Rebalance 是 Kafka 消费者端实现高可用的重要手段。


他人理解：

Kafka体系架构=M个producer +N个broker +K个consumer+ZK集群

producer:生产者

Broker：服务代理节点，Kafka服务实例。
n个组成一个Kafka集群，通常一台机器部署一个Kafka实例，一个实例挂了其他实例仍可以使用，体现了高可用

consumer：消费者
消费topic 的消息， 一个topic 可以让若干个consumer消费，若干个consumer组成一个 consumer group ，一条消息只能被consumer group 中一个consumer消费，若干个partition 被若干个consumer 同时消费，达到消费者高吞吐量

topic ：主题

partition： 一个topic 可以拥有若干个partition（从 0 开始标识partition ），分布在不同的broker 上， 实现发布与订阅时负载均衡。producer 通过自定义的规则将消息发送到对应topic 下某个partition，以offset标识一条消息在一个partition的唯一性。
一个partition拥有多个replica，提高容灾能力。 
replica 包含两种类型：leader 副本、follower副本，
leader副本负责读写请求，follower 副本负责同步leader副本消息，通过副本选举实现故障转移。
partition在机器磁盘上以log 体现，采用顺序追加日志的方式添加新消息、实现高吞吐量
	

3. kafka几种类型
- apche kafka ： 也称社区版 Kafka。优势在于迭代速度快，社区响应度高，使用它可以让你有更高的把控度；缺陷在于仅提供基础核心组件，缺失一些高级的特性。
- Confluent Kafka，Confluent 公司提供的 Kafka。优势在于集成了很多高级特性且由 Kafka 原班人马打造，质量上有保证；缺陷在于相关文档资料不全，普及率较低，没有太多可供参考的范例。
- CDH/HDP Kafka，大数据云公司提供的 Kafka，内嵌 Apache Kafka。优势在于操作简单，节省运维成本；缺陷在于把控度低，演进速度较慢。通过便捷化的界面操作将 Kafka 的安装、运维、管理、监控全部统一在控制台中。



































